<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GE Log√≠stica - Sistema de Cotizaci√≥n de Fletes (MVC)</title>
    <link rel="stylesheet" href="assets/css/styles.css">
</head>

<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="logo-container">
                    <img src="https://www.gelogistica.co/wp-content/uploads/2025/05/pagina-logo.png" alt="GE Log√≠stica">
                </div>
                <div class="header-text">
                    <h1>Sistema de C√°lculo de Fletes - Modelo Mixto</h1>
                    <p>Dimensi√≥n Operativa (Volumen √ó Distancia) + Dimensi√≥n Financiera (Peso √ó Costos)</p>
                </div>
                <a href="modelo_costos_flete.html" style="margin-left:16px;background:#2563eb;color:#fff;padding:8px 18px;border-radius:4px;text-decoration:none;font-size:1em;">Modelo de Costos</a>
                <a href="modelo_tabla_flete.html" style="margin-left:16px;background:#059669;color:#fff;padding:8px 18px;border-radius:4px;text-decoration:none;font-size:1em;">Tabla Flete Volumen</a>
            </div>
        </header>

        <!-- M√≥dulo 1: Configuraci√≥n del Viaje -->
        <section class="card">
            <h2>Configuraci√≥n del Viaje</h2>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <!-- Ruta -->
                <div>
                    <div class="form-group">
                        <label for="ruta">Ruta de Transporte:</label>
                        <select id="ruta" onchange="cargarRuta()">
                            <option value="">-- Seleccione una ruta --</option>
                        </select>
                    </div>
                    <div id="infoRuta" class="info-box" style="display:none;">
                        <p><strong>Destinos disponibles:</strong> <span id="destinos"></span></p>
                        <p><strong>Distancia:</strong> <span id="distancia"></span> km</p>
                    </div>
                </div>

                <!-- Cami√≥n -->
                <div>
                    <div class="form-group">
                        <label for="tipoCamionSeleccionado">Tipo de Cami√≥n:</label>
                        <select id="tipoCamionSeleccionado" onchange="validarCapacidadCamion()">
                            <option value="">-- Seleccione tipo de cami√≥n --</option>
                            <option value="25">Cami√≥n 25 m¬≥</option>
                            <option value="37">Cami√≥n 37 m¬≥</option>
                            <option value="45">Cami√≥n 45 m¬≥</option>
                        </select>
                        <small style="color: #64748b; margin-top: 5px; display: block;">Seleccione el cami√≥n antes de
                            agregar clientes</small>
                    </div>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 20px;">
                <div class="form-group">
                    <label for="fechaDespacho">Fecha de Despacho:</label>
                    <input type="date" id="fechaDespacho">
                </div>
                <div class="form-group">
                    <label for="observaciones">Observaciones:</label>
                    <input type="text" id="observaciones" placeholder="Notas adicionales del despacho">
                </div>
            </div>

            <!-- Agregar Destino -->
            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border-color);">
                <strong style="color: var(--text-dark); font-size: 0.9em; display: block; margin-bottom: 10px;">Agregar
                    Nuevo Destino a la Ruta</strong>
                <div style="display: grid; grid-template-columns: 2fr 1fr auto; gap: 10px;">
                    <input type="text" id="nuevoDestino" placeholder="Nombre del destino" class="form-control">
                    <input type="number" id="nuevoDestinoKm" placeholder="Kil√≥metros" min="1" class="form-control">
                    <button onclick="agregarDestinoARuta()" class="btn-secondary">Agregar Destino</button>
                </div>
            </div>
        </section>

        <!-- M√≥dulo 2: Agregar Pedidos/Productos a la Carga -->
        <section class="card">
            <h2>üì¶ Carga del Cami√≥n</h2>
            
            <div style="background: #eff6ff; padding: 15px; border-radius: 6px; margin-bottom: 20px; border-left: 3px solid #2563eb;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <p style="color: #1e40af; font-size: 0.95em; margin: 0; font-weight: 600;">
                            üí° Agregar productos al cami√≥n
                        </p>
                        <p style="color: #64748b; font-size: 0.85em; margin: 5px 0 0 0;">
                            El sistema validar√° que no exceda la capacidad seleccionada
                        </p>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 0.85em; color: #64748b;">Ocupaci√≥n</div>
                        <div id="porcentajeOcupacion" style="font-size: 1.3em; font-weight: bold; color: #2563eb;">0%</div>
                    </div>
                </div>
            </div>

            <div id="alertaCapacidad" class="alert alert-warning" style="display:none; margin-bottom: 15px;"></div>

            <!-- Formulario para agregar productos -->
            <div style="background: white; border: 1px solid #e2e8f0; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <h3 style="margin: 0 0 15px 0; font-size: 0.95em; color: #334155;">‚ûï Agregar Producto/Pedido</h3>
                
                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="nombreProducto">Producto:</label>
                        <input type="text" id="nombreProducto" list="productosEjemplo" placeholder="Ej: COL MONARCA 100X190X28">
                        <datalist id="productosEjemplo">
                            <option value="LAM UT 200,0x200,0x004,0">
                            <option value="COL MONARCA 100X190X28 JAC">
                            <option value="COL CONFORT PREMIUM 140X190X34 NUBE 4.0">
                        </datalist>
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="clientePedido">Cliente:</label>
                        <input type="text" id="clientePedido" placeholder="Nombre cliente">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="ordenCompra">Orden de Compra:</label>
                        <input type="text" id="ordenCompra" placeholder="OC-XXX">
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 10px; margin-bottom: 10px;">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="destinoCliente">üìç Destino del Pedido:</label>
                        <select id="destinoCliente">
                            <option value="">-- Seleccione destino --</option>
                        </select>
                        <small style="color: #64748b; margin-top: 3px; display: block;">Distancia: <span id="distanciaSeleccionada">0 km</span></small>
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="cantidadProducto">Cantidad:</label>
                        <input type="number" id="cantidadProducto" placeholder="100" min="1">
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr auto; gap: 10px;">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="volumenUnitario">Vol. Unit. (m¬≥):</label>
                        <input type="number" id="volumenUnitario" placeholder="0.05" step="0.001">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="pesoUnitario">Peso Unit. (kg):</label>
                        <input type="number" id="pesoUnitario" placeholder="50" step="0.1">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="precioUnitario">Precio Unit. ($):</label>
                        <input type="number" id="precioUnitario" placeholder="35000" step="100">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>Vol. Total:</label>
                        <input type="text" id="volumenTotalPrevio" readonly style="background: #f1f5f9; font-weight: bold;" value="0.00 m¬≥">
                    </div>
                    <button onclick="agregarPedido()" class="btn-secondary" style="height: fit-content; margin-top: 24px;">
                        ‚ûï Agregar
                    </button>
                </div>
                
                <!-- Botones de ejemplo -->
                <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #e2e8f0;">
                    <small style="color: #64748b; display: block; margin-bottom: 8px;">‚ö° Ejemplos r√°pidos:</small>
                    <div style="display: flex; gap: 8px;">
                        <button onclick="cargarEjemplo(1)" class="btn-secondary" style="padding: 6px 12px; font-size: 0.85em;">
                            Colch√≥n Monarca
                        </button>
                        <button onclick="cargarEjemplo(2)" class="btn-secondary" style="padding: 6px 12px; font-size: 0.85em;">
                            Colch√≥n Premium
                        </button>
                        <button onclick="cargarEjemplo(3)" class="btn-secondary" style="padding: 6px 12px; font-size: 0.85em;">
                            Laminado 200x200
                        </button>
                    </div>
                </div>
            </div>

            <!-- Lista de pedidos agregados -->
            <div id="listaPedidos" style="display:none; margin-top: 20px;">
                <h3 style="margin: 0 0 15px 0; font-size: 0.95em; color: #334155;">üìã Pedidos en el Cami√≥n</h3>
                <div id="pedidosContainer"></div>
            </div>
        </section>

        <!-- M√≥dulo 3: Resumen y C√°lculo del Despacho -->
        <section class="card">
            <h2>Resumen del Despacho</h2>
            <div class="summary-section">
                <h3>Indicadores Operativos</h3>
                <div class="summary-grid">
                    <div class="summary-item"><span id="indicadorOcupacion">Ocupaci√≥n del cami√≥n (%)</span></div>
                    <div class="summary-item"><span id="indicadorDesperdicio">Capacidad desperdiciada (%)</span></div>
                    <div class="summary-item"><span id="indicadorVolumen">Volumen transportado (m¬≥)</span></div>
                    <div class="summary-item"><span id="indicadorTipoCamion">Tipo de cami√≥n utilizado</span></div>
                    <div class="summary-item"><span id="indicadorNumClientes">N√∫mero de clientes por despacho</span></div>
                </div>
                <h3 style="margin-top:24px;">Indicadores Econ√≥micos / Financieros</h3>
                <div class="summary-grid">
                    <div class="summary-item"><span id="indicadorFleteVenta">% Flete sobre venta</span></div>
                    <div class="summary-item"><span id="indicadorFleteCliente">Costo del flete por cliente</span></div>
                    <div class="summary-item"><span id="indicadorFleteProducto">Costo del flete por producto</span></div>
                    <div class="summary-item"><span id="indicadorVentaSinIVA">Valor total de venta sin IVA</span></div>
                    <div class="summary-item"><span id="indicadorCostoProductos">Costo total de productos</span></div>
                </div>
            </div>
            <!-- Detalle por Cliente -->
            <div id="detalleClientes" style="margin-top: 20px;">
                <h3 style="color: #1a3a52; margin-bottom: 12px; font-size: 1em; font-weight: 600;">Detalle por Cliente</h3>
                <div id="detalleClientesContainer"></div>
            </div>
            <button onclick="calcularDespacho()" class="btn-primary" style="margin-top: 15px;">Calcular Despacho</button>
        </section>

        <!-- M√≥dulo 4: Reporte Final Detallado -->
        <section class="card" id="reporteSection" style="display:none;">
            <h2>Reporte Final de Cotizaci√≥n</h2>

            <h3>Por Producto</h3>
            <div class="table-responsive">
                <table id="tablaProductos">
                    <thead>
                        <tr>
                            <th>Cliente</th>
                            <th>Destino</th>
                            <th>Distancia (km)</th>
                            <th>Producto</th>
                            <th>Unidades</th>
                            <th>Vol. Unit. (m¬≥)</th>
                            <th>Vol. Total (m¬≥)</th>
                            <th>Peso Unit. (kg)</th>
                            <th>Peso Total (kg)</th>
                            <th>Precio Unit.</th>
                            <th>Valor Total</th>
                            <th>Flete Asignado</th>
                            <th>% Flete/Venta</th>
                        </tr>
                    </thead>
                    <tbody id="tablaProductosBody"></tbody>
                </table>
            </div>

            <h3>Por Cliente</h3>
            <div class="table-responsive">
                <table id="tablaClientes">
                    <thead>
                        <tr>
                            <th>Cliente</th>
                            <th>Destino</th>
                            <th>Distancia (km)</th>
                            <th>Vol. Total (m¬≥)</th>
                            <th>Peso Total (kg)</th>
                            <th>Factor (Vol√óDist)</th>
                            <th>% Particip. Flete</th>
                            <th>Valor Total</th>
                            <th>Flete Total</th>
                            <th>% Flete/Venta</th>
                        </tr>
                    </thead>
                    <tbody id="tablaClientesBody"></tbody>
                </table>
            </div>

            <h3>An√°lisis del Modelo Mixto</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                <!-- Dimensi√≥n Operativa -->
                <div style="background: #eff6ff; padding: 20px; border-radius: 8px; border: 1px solid #bfdbfe;">
                    <h4 style="color: #1e40af; margin: 0 0 15px 0; font-size: 1em;">üì¶ Dimensi√≥n Operativa (Volumen)
                    </h4>
                    <div id="resumenOperativo"></div>
                </div>

                <!-- Dimensi√≥n Financiera -->
                <div style="background: #f0fdf4; padding: 20px; border-radius: 8px; border: 1px solid #bbf7d0;">
                    <h4 style="color: #166534; margin: 0 0 15px 0; font-size: 1em;">üí∞ Dimensi√≥n Financiera (Peso)</h4>
                    <div id="resumenFinanciero"></div>
                </div>
            </div>

            <div class="actions">
                <button onclick="exportarReporte()" class="btn-secondary">Exportar Reporte</button>
                <button onclick="nuevoDespacho()" class="btn-secondary">Nuevo Despacho</button>
            </div>
        </section>

        <!-- Ejemplo de tabla de asignaci√≥n de flete por volumen -->
        <h2 style="margin-top:32px;">Ejemplo de tabla de asignaci√≥n de flete por volumen</h2>
        <table style="margin-top:12px;">
            <thead>
                <tr>
                    <th>N¬∞ Ruta</th>
                    <th>Nombre Ruta</th>
                    <th>Tipo Veh√≠culo</th>
                    <th>Costo Flete ($)</th>
                    <th>Canal</th>
                    <th>ID Producto</th>
                    <th>Descripci√≥n Producto</th>
                    <th>Medidas (m)</th>
                    <th>Unidades</th>
                    <th>Vol. Unitario (m¬≥)</th>
                    <th>Vol. Total (m¬≥)</th>
                    <th>Ocupaci√≥n Volum√©trica (%)</th>
                    <th>Valor m¬≥ (Flete/Cami√≥n)</th>
                    <th>Valor Flete Producto</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>08</td>
                    <td>ALBAN - SASAIMA - VILLETA - GUADUAS - HONDA</td>
                    <td>25 m¬≥</td>
                    <td>970.659</td>
                    <td>Tradicional</td>
                    <td>90050271</td>
                    <td>COLCH√ìN MONARCA 100X190X28 JAC</td>
                    <td>1.00 x 1.90 x 0.28</td>
                    <td>6</td>
                    <td>0.53</td>
                    <td>3.18</td>
                    <td>12.72%</td>
                    <td>38.826,36</td>
                    <td>123.947,76</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Modelos -->
    <script src="models/RutaModel.js"></script>
    <script src="models/CamionModel.js"></script>
    <script src="models/DespachoModel.js"></script>
    <script src="models/CalculoModel.js"></script>
    <script src="models/ClienteSAPModel.js"></script>

    <!-- Base de Datos (opcional - si existe BD) -->
    <script src="config/database.js"></script>
    <script src="database/DatabaseAdapter.js"></script>

    <!-- Vistas -->
    <script src="views/ConfiguracionViajeView.js"></script>
    <script src="views/ClientesView.js"></script>
    <script src="views/ResumenView.js"></script>
    <script src="views/ReportesView.js"></script>

    <!-- Controlador -->
    <script src="controllers/AppController.js"></script>

    <!-- Aplicaci√≥n Principal -->
    <script src="assets/js/app.js"></script>
    
    <!-- Manejador de Destinos -->
    <script src="assets/js/destinos-handler.js"></script>
</body>

</html>