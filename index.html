<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GE Log铆stica - Sistema de Cotizaci贸n de Fletes (MVC)</title>
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="stylesheet" href="assets/css/custom.css">
</head>

<body>
    <div id="toastMsg" style="display:none;position:fixed;top:32px;left:50%;transform:translateX(-50%);background:#dc2626;color:#fff;padding:14px 32px;border-radius:8px;z-index:9999;font-size:1.08em;box-shadow:0 2px 12px #0002;">Primero debes diligenciar la Configuraci贸n del Viaje.</div>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="logo-container">
                    <img src="https://www.gelogistica.co/wp-content/uploads/2025/05/pagina-logo.png" alt="GE Log铆stica">
                </div>
                <div class="header-text">
                    <h1>Sistema de C谩lculo de Fletes - Modelo </h1>
                    <p>Dimensi贸n Operativa (Volumen)</p>
                </div>
            </div>
        </header>

        <!-- M贸dulo 1: Configuraci贸n del Viaje -->
        <section class="card">
            <h2>Configuraci贸n del Viaje</h2>
            <form id="configuracion-viaje-form">
                <div class="config-viaje-grid">
                    <!-- Fila 1: 3 columnas -->
                    <div class="form-group">
                        <label for="ruta">Ruta de Transporte:</label>
                        <select id="ruta" onchange="cargarRuta();">
                            <!-- Opciones generadas din谩micamente por JS -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="tipoCamionSeleccionado">Tipo de Cami贸n:</label>
                        <select id="tipoCamionSeleccionado" onchange="validarCapacidadCamion();">
                            <!-- Opciones generadas din谩micamente por JS -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="fechaDespacho">Fecha de Despacho:</label>
                        <input type="date" id="fechaDespacho">
                    </div>
                    <!-- Fila 2: Info de ruta centrada -->
                    <div></div>
                    <div style="grid-column: 2 / 3; width: 100%; margin-top: 10px; justify-self: center; text-align:center;">
                        <div id="infoRuta" class="info-box" style="display:none;"></div>
                    </div>
                    <div></div>
                </div>
            </form>
        </section>

        <!-- Card separada para el bot贸n Nuevo Pedido -->
        <section class="card" style="margin-bottom:18px;">
            <h2>Asignacion de pedidos o picking</h2>
            <div style="margin-top:12px;margin-bottom:8px;color:#334155;font-size:0.98em;">
                        <strong>Buscar pedido (origen de datos: SAP, Servicios GE, Espumred, etc):</strong> Utiliza esta barra para buscar y traer autom谩ticamente los datos del pedido desde el origen de datos seleccionado (en el futuro, la integraci贸n llenar谩 el formulario con la informaci贸n real del sistema).
            </div>
            <div style="display:flex;align-items:center;gap:12px;margin-bottom:18px;">
                <input type="text" id="busquedaSAP" class="form-control" placeholder="Buscar pedido por c贸digo SAP..." style="max-width:260px;">
                <select id="tipoBusquedaSAP" class="form-control" style="max-width:180px;">
                    <option value="codigo">C贸digo SAP</option>
                    <option value="cliente">Cliente</option>
                    <option value="direccion">Direcci贸n</option>
                </select>
                <button type="button" class="btn btn-primary btn-sm" id="btnBuscarSAP">Buscar</button>
            </div>
            <button type="button" class="btn btn-primary" id="btnAbrirModalPedidoPicking">Agregar pedido manualmente</button>
        </section>

        <!-- M贸dulo 2: Agregar Pedidos/Productos a la Carga -->
        <section class="card" id="carga-camion-section">
            <!-- Secci贸n restaurada: Carga del Cami贸n -->
            <h2>Carga del Cami贸n</h2>
            <div style="background: #eff6ff; padding: 15px; border-radius: 6px; margin-bottom: 20px; border-left: 3px solid #2563eb;">
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; align-items: center; gap: 18px;">
                    <div style="text-align:left;">
                        <p style="color: #1e40af; font-size: 0.95em; margin: 0; font-weight: 600;">Agregar pedidos al cami贸n
                        </p>
                        <p style="color: #64748b; font-size: 0.85em; margin: 5px 0 0 0;">El sistema validar谩 que no
                        exceda la capacidad seleccionada</p>
                    </div>
                    <div style="justify-self:center;">
                        <div style="font-size: 0.85em; color: #64748b; text-align:center;">Ocupaci贸n</div>
                        <div id="ocupacionVisual"
                            style="width:120px;height:60px;background:#e5e7eb;border-radius:12px;position:relative;overflow:hidden;box-shadow:0 2px 8px #0001;border:2px solid #fb923c;display:inline-block;margin-top:4px;">
                        </div>
                    </div>
                    <div style="text-align:right;">
                        <div id="porcentajeOcupacion"
                            style="font-size: 1.3em; font-weight: bold; color: #2563eb; min-width: 60px;">0%</div>
                    </div>
                </div>
            </div>
            <div id="alertaCapacidad" class="alert alert-warning" style="display:none; margin-bottom: 15px;"></div>
            <!-- Modal para el formulario de pedido picking SAP -->
            <div id="modalPedidoPickingSAP"
                class="modal"
                style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:#0008;z-index:9999;align-items:center;justify-content:center;">
                <div
                    style="background:#fff;padding:32px 24px;border-radius:12px;max-width:900px;width:96vw;box-shadow:0 4px 32px #0003;position:relative;overflow:auto;max-height:90vh;">
                    <h2 style="margin-top:0;color:#1e40af;font-size:1.2em;">Nuevo Pedido (Picking SAP)</h2>
                    <div style="margin-bottom:12px;color:#334155;font-size:0.98em;">
                    </div>
                    <form id="formPedidoPicking"
                        style="background:none;padding:0;border-radius:0;margin-bottom:0;box-shadow:none;">
                        <!-- Modal para agregar/editar producto -->
                        <div id="modalProductoPicking"
                            class="modal"
                            style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:#0008;z-index:9999;align-items:center;justify-content:center;">
                            <div
                                style="background:#fff;padding:32px 24px;border-radius:12px;max-width:420px;width:90vw;box-shadow:0 4px 32px #0003;position:relative;">
                                <h3 id="modalProductoTitulo" style="margin-top:0;">Agregar Producto</h3>
                                <div class="form-group">
                                    <label>C贸digo:</label>
                                    <input type="text" id="modalProdCodigo" class="form-control" placeholder="C贸digo SAP">
                                </div>
                                <div class="form-group">
                                    <label>Descripci贸n:</label>
                                    <input type="text" id="modalProdDescripcion" class="form-control" placeholder="Descripci贸n">
                                </div>
                                <div class="form-group">
                                    <label>Lote:</label>
                                    <input type="text" id="modalProdLote" class="form-control" placeholder="Lote">
                                </div>
                                <div class="form-group">
                                    <label>Unidad:</label>
                                    <input type="text" id="modalProdUnidad" class="form-control" value="UN">
                                </div>
                                <div class="form-group">
                                    <label>Cantidad:</label>
                                    <input type="number" id="modalProdCantidad" class="form-control" min="1" value="1">
                                </div>
                                <div class="form-group">
                                    <label>Picking:</label>
                                    <input type="number" id="modalProdPicking" class="form-control" min="0" value="0">
                                </div>
                                <div style="margin-top:18px;display:flex;gap:12px;justify-content:flex-end;">
                                    <button class="btn btn-secondary" id="modalProdCancelar">Cancelar</button>
                                    <button class="btn btn-success" id="modalProdGuardar">Guardar</button>
                                </div>
                            </div>
                        </div>
                        <div style="margin-bottom:8px;color:#334155;font-size:0.98em;">
                            <strong>Aqui se podran agregar lo pedidos de manera simulada de manera manual:</strong> 
                        </div>
                        <!-- Barra de b煤squeda y selector de tipo de b煤squeda -->
               
                        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:18px;">
                            <div class="form-group">
                                <label>N掳 Pedido SAP:</label>
                                <input type="text" id="pickingPedido" class="form-control" placeholder="Ej: 729181">
                            </div>
                            <div class="form-group">
                                <label>Fecha emisi贸n:</label>
                                <input type="date" id="pickingFecha" class="form-control">
                            </div>
                            <div class="form-group">
                                <label>Cliente/Destinatario:</label>
                                <input type="text" id="pickingCliente" class="form-control"
                                    placeholder="Ej: HOYOS HOYOS DAGOBERTO">
                            </div>
                            <div class="form-group">
                                <label>NIT/CC:</label>
                                <input type="text" id="pickingNIT" class="form-control" placeholder="Ej: 83028606">
                            </div>
                            <div class="form-group">
                                <label>Direcci贸n de entrega:</label>
                                <input type="text" id="pickingDireccion" class="form-control"
                                    placeholder="Ej: CR 66 A # 92 BR PRADERA">
                            </div>
                            <div class="form-group">
                                <label>Ciudad:</label>
                                <input type="text" id="pickingCiudad" class="form-control" placeholder="Ej: BOGOTA">
                            </div>
                        </div>
                        <div style="margin-top:12px;display:grid;grid-template-columns:1fr 1fr 1fr;gap:18px;">
                            <div class="form-group">
                                <label>Zona de transporte:</label>
                                <input type="text" id="pickingZona" class="form-control" placeholder="Ej: BOGOTA">
                            </div>
                            <div class="form-group">
                                <label>N掳 Transporte:</label>
                                <input type="text" id="pickingTransporte" class="form-control" placeholder="">
                            </div>
                            <div class="form-group">
                                <label>Ruta:</label>
                                <input type="text" id="pickingRuta" class="form-control" placeholder="">
                            </div>
                        </div>
                        <div style="margin-top:12px;">
                            <label>Observaciones:</label>
                            <input type="text" id="pickingObservaciones" class="form-control"
                                placeholder="Observaciones generales">
                        </div>
                        <div style="margin-top:18px;">
                            <label style="font-weight:600;">Productos del Pedido</label>
                            <table id="tablaProductosPicking" style="width:100%;margin-top:8px;border-collapse:collapse;">
                                <thead>
                                    <tr style="background:#e0e7ef;">
                                        <th>C贸digo</th>
                                        <th>Descripci贸n</th>
                                        <th>Lote</th>
                                        <th>Unidad</th>
                                        <th>Cantidad</th>
                                        <th>Picking</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="tbodyProductosPicking">
                                    <!-- Filas din谩micas -->
                                </tbody>
                            </table>
                            <button type="button" class="btn btn-secondary btn-sm" id="btnAgregarProductoPicking"
                                style="margin-top:8px;">Agregar producto</button>
                        </div>
                        <div style="margin-top:18px;display:flex;gap:18px;align-items:center;">
                            <div class="form-group" style="flex:1;">
                                <label>Costo SAP (simulado):</label>
                                <input type="text" id="pickingCostoSAP" class="form-control"
                                    value="Pendiente de integraci贸n" readonly style="background:#f1f5f9;color:#64748b;">
                            </div>
                            <button type="button" class="btn btn-success" id="btnGuardarPicking">Guardar Pedido</button>
                        </div>
                    </form>
                    <button type="button" class="btn btn-secondary" id="btnCerrarModalPedidoPicking"
                        style="position:absolute;top:12px;right:18px;font-size:1.3em;">&times;</button>
                </div>
            </div>
        </section>

        <!-- M贸dulo 3: Resumen y C谩lculo del Despacho -->
        <section class="card">
            <h2>Resumen del Despacho</h2>
            <div class="summary-section">
                <h3>Indicadores Operativos</h3>
                <div class="summary-grid">
                    <div class="summary-item"><span id="indicadorOcupacion">Ocupaci贸n del cami贸n (%)</span></div>
                    <div class="summary-item"><span id="indicadorDesperdicio">Capacidad desperdiciada (%)</span></div>
                    <div class="summary-item"><span id="indicadorVolumen">Volumen transportado (m鲁)</span></div>
                    <div class="summary-item"><span id="indicadorTipoCamion">Tipo de cami贸n utilizado</span></div>
                    <div class="summary-item"><span id="indicadorNumClientes">N煤mero de clientes por despacho</span>
                    </div>
                </div>
                <h3 style="margin-top:24px;">Indicadores Econ贸micos / Financieros</h3>
                <div class="summary-grid">
                    <div class="summary-item"><span id="indicadorFleteVenta">% Flete sobre venta</span></div>
                    <div class="summary-item"><span id="indicadorFleteCliente">Costo del flete por cliente</span></div>
                    <div class="summary-item"><span id="indicadorFleteProducto">Costo del flete por producto</span>
                    </div>
                    <div class="summary-item"><span id="indicadorVentaSinIVA">Valor total de venta sin IVA</span></div>
                    <div class="summary-item"><span id="indicadorCostoProductos">Costo total de productos</span></div>
                </div>
            </div>
            <!-- Detalle por Cliente -->
            <div id="detalleClientes" style="margin-top: 20px;">
                <h3 style="color: #1a3a52; margin-bottom: 12px; font-size: 1em; font-weight: 600;">Detalle por Cliente
                </h3>
                <div id="detalleClientesContainer"></div>
            </div>
            <button onclick="calcularDespacho()" class="btn-primary" style="margin-top: 15px;">Calcular
                Despacho</button>
        </section>

        <!-- M贸dulo 4: Reporte Final Detallado -->
        <section class="card" id="reporteSection" style="display:none;">
            <h2>Reporte Final de Cotizaci贸n</h2>

            <h3>Por Producto</h3>
            <div class="table-responsive">
                <table id="tablaProductos">
                    <thead>
                        <tr>
                            <th>Cliente</th>
                            <th>Destino</th>
                            <th>Distancia (km)</th>
                            <th>Producto</th>
                            <th>Unidades</th>
                            <th>Vol. Unit. (m鲁)</th>
                            <th>Vol. Total (m鲁)</th>
                            <th>Peso Unit. (kg)</th>
                            <th>Peso Total (kg)</th>
                            <th>Precio Unit.</th>
                            <th>Valor Total</th>
                            <th>Flete Asignado</th>
                            <th>% Flete/Venta</th>
                        </tr>
                    </thead>
                    <tbody id="tablaProductosBody"></tbody>
                </table>
            </div>

            <h3>Por Cliente</h3>
            <div class="table-responsive">
                <table id="tablaClientes">
                    <thead>
                        <tr>
                            <th>Cliente</th>
                            <th>Destino</th>
                            <th>Distancia (km)</th>
                            <th>Vol. Total (m鲁)</th>
                            <th>Peso Total (kg)</th>
                            <th>Factor (VolDist)</th>
                            <th>% Particip. Flete</th>
                            <th>Valor Total</th>
                            <th>Flete Total</th>
                            <th>% Flete/Venta</th>
                        </tr>
                    </thead>
                    <tbody id="tablaClientesBody"></tbody>
                </table>
            </div>

            <h3>An谩lisis del Modelo Mixto</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                <!-- Dimensi贸n Operativa -->
                <div style="background: #eff6ff; padding: 20px; border-radius: 8px; border: 1px solid #bfdbfe;">
                    <h4 style="color: #1e40af; margin: 0 0 15px 0; font-size: 1em;"> Dimensi贸n Operativa (Volumen)
                    </h4>
                    <div id="resumenOperativo"></div>
                </div>

                <!-- Dimensi贸n Financiera -->
                <div style="background: #f0fdf4; padding: 20px; border-radius: 8px; border: 1px solid #bbf7d0;">
                    <h4 style="color: #166534; margin: 0 0 15px 0; font-size: 1em;"> Dimensi贸n Financiera (Peso)</h4>
                    <div id="resumenFinanciero"></div>
                </div>
            </div>

            <div class="actions">
                <button onclick="exportarReporte()" class="btn-secondary">Exportar Reporte</button>
                <button onclick="nuevoDespacho()" class="btn-secondary">Nuevo Despacho</button>
            </div>
        </section>

        <!-- Ejemplo de tabla de asignaci贸n de flete por volumen -->
        <h2 style="margin-top:32px;">Ejemplo de tabla de asignaci贸n de flete por volumen</h2>
        <div style="overflow-x:auto; max-width:100vw;">
            <table style="margin-top:12px; min-width:900px;">
                <thead>
                    <tr>
                        <th>N掳 Ruta</th>
                        <th>Nombre Ruta</th>
                        <th>Tipo Veh铆culo</th>
                        <th>Costo Flete ($)</th>
                        <th>Canal</th>
                        <th>ID Producto</th>
                        <th>Descripci贸n Producto</th>
                        <th>Medidas (m)</th>
                        <th>Unidades</th>
                        <th>Vol. Unitario (m鲁)</th>
                        <th>Vol. Total (m鲁)</th>
                        <th>Ocupaci贸n Volum茅trica (%)</th>
                        <th>Valor m鲁 (Flete/Cami贸n)</th>
                        <th>Valor Flete Producto</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>08</td>
                        <td>ALBAN - SASAIMA - VILLETA - GUADUAS - HONDA</td>
                        <td>25 m鲁</td>
                        <td>970.659</td>
                        <td>Tradicional</td>
                        <td>90050271</td>
                        <td>COLCHN MONARCA 100X190X28 JAC</td>
                        <td>1.00 x 1.90 x 0.28</td>
                        <td>6</td>
                        <td>0.53</td>
                        <td>3.18</td>
                        <td>12.72%</td>
                        <td>38.826,36</td>
                        <td>123.947,76</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>


    <!-- Modelos -->
    <script src="models/RutaModel.js"></script>
    <script src="models/DespachoModel.js"></script>

    <!-- Base de Datos (opcional - si existe BD) -->
    <script src="config/database.js"></script>
    <script src="database/DatabaseAdapter.js"></script>

    <!-- Vistas -->
    <script src="views/ConfiguracionViajeView.js"></script>
    <script src="views/ClientesView.js"></script>
    <script src="views/ResumenView.js"></script>
    <script src="views/ReportesView.js"></script>

    <!-- Controlador -->
    <script src="controllers/AppController.js"></script>

    <!-- Aplicaci贸n Principal -->
    <script src="assets/js/app.js"></script>
    <script src="assets/js/main.js"></script>

    <!-- Manejador de Destinos -->
    <script src="assets/js/destinos-handler.js"></script>

    <!-- L贸gica del nuevo modal de pedido -->
    <script src="assets/js/nuevo-modal-pedido.js"></script>
    <script>
    // L贸gica para abrir/cerrar el modal de pedido picking SAP
    const btnAbrirModalPedidoPicking = document.getElementById('btnAbrirModalPedidoPicking');
    const modalPedidoPickingSAP = document.getElementById('modalPedidoPickingSAP');
    const btnCerrarModalPedidoPicking = document.getElementById('btnCerrarModalPedidoPicking');
    if(btnAbrirModalPedidoPicking && modalPedidoPickingSAP && btnCerrarModalPedidoPicking) {
        btnAbrirModalPedidoPicking.onclick = () => { modalPedidoPickingSAP.style.display = 'flex'; };
        btnCerrarModalPedidoPicking.onclick = () => { modalPedidoPickingSAP.style.display = 'none'; };
        modalPedidoPickingSAP.onclick = (e) => { if(e.target === modalPedidoPickingSAP) modalPedidoPickingSAP.style.display = 'none'; };
    }
    </script>
</body>

</html>